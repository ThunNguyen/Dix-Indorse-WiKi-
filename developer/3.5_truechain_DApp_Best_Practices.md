# 初链智能合约 —— 最佳实践

这篇文档旨在为初链智能合约开发人员提供一些智能合约开发经验总结。
包括智能合约编码规范，安全开发理念等。

## 编码规范

我们知道每一门语言都有其相应的编码规范。
初链目前支持的智能合约开发语言Solidity，我们以此为例。

### 命名规范

* 合约，库，事件，枚举及结构体命名应该使用首字母大写的方式。
例如：`MyContract, TransferToken`
* 函数，参数，变量及修饰器命名应该使用首字母小写的方式。
例如：`getBalance, initialSupply, onlyOwner`

### 代码格式

* 缩进使用四个空格而不是Tab。
* 合约，函数之间应该有空行。
* 定义合约，函数，库和结构体等时，推荐左括号跟定义在一行。
* 一个单行表达式，括号中避免不必要的空格。
* 每行不应该太长，控制在79个字符以内。

### 函数编写

* 函数的顺序，推荐：
1. 构造函数
2. 回退函数（如果需要）
3. 外部函数（`external`）
4. 公有函数（`public`）
5. 内部函数（`internal`）
6. 私有函数（`private`）
* 明确函数的可见性。
* 函数可见性在修饰符的前面。
例如：`public onlyOwner`
* 函数和事件的定义要能明显区分。
例如：函数为 `transferToken`，而事件为，`LogTransfer`。

## 安全准则

开发智能合约需要一个全新的工程思维，它不同于我们以往项目的开发。
一旦一个智能合约部署到区块链网络上，它将是永不可变的，且将永久存在。
所以安全的开发智能合约，需要倍加谨慎。这里总结了一些安全开发的理念。
希望能帮助大家避免写出某些不安全的开发代码。

### 面对错误编码

尽早且明确的暴露问题，代码必须能够正确的处理出现的bug和漏洞。始终保证以下规则：
* 当智能合约出现错误时，停止合约，（“断路开关”）
* 管理账户的资金风险（限制转账速率、最大转账额度）
* 有效的途径来进行bug修复和功能提升

### 函数代码顺序

一个好的实践是将函数结构化为：条件，行为，交互。

* 首先，检查所有前置的条件；
* 然后，对合约的状态进行修改；
* 最后，与其它合约进行交互。

### 谨慎发布

尽量在正式发布智能合约之前，发现并修复可能的bug。
* 对智能合约进行彻底的测试，并在任何新的攻击手法被发现后及时的测试(包括已经发布的合约)
* 从原始版本在测试网（testnet）上发布开始，便提供bug赏金计划
* 阶段性发布，每个阶段都提供足够的测试

### 保持简洁

复杂的智能合约会增加出错的风险。
* 确保智能合约逻辑简洁
* 确保合约和函数模块化
* 使用已经被广泛使用的合约或工具（比如，数学库）
* 条件允许的话，清晰明了比性能更重要
* 只在系统的去中心化部分使用区块链

### 保持更新

确保获取到最新的安全进展。
* 在任何新的漏洞被发现时检查你的智能合约
* 尽可能快的将使用到的库或者工具更新到最新
* 使用最新的安全技术

### 清楚区块链的特性

* 特别小心针对外部合约的调用，因为可能执行的是一段恶意代码然后更改控制流程
* 清楚public function是公开的，意味着可以被恶意调用。同时private data也是对他人可见的
* 清楚gas的花费和区块的gas limit

